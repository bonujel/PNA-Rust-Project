# PingCAP Talent Plan - Rust å®è·µï¼šæ—¥å¿—ç»“æ„åŒ–é”®å€¼å­˜å‚¨

[PingCAP Talent Plan](https://github.com/pingcap/talent-plan) Rust è¯¾ç¨‹å®è·µé¡¹ç›®ï¼Œå®ç°äº†ä¸€ä¸ªåŸºäº Bitcask å­˜å‚¨æ¨¡å‹çš„æŒä¹…åŒ–é”®å€¼å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒå®¢æˆ·ç«¯-æœåŠ¡ç«¯ç½‘ç»œæ¶æ„å’Œå¯æ’æ‹”å­˜å‚¨å¼•æ“ã€‚

## é¡¹ç›®è¿›åº¦

| é˜¶æ®µ | çŠ¶æ€ | æè¿° |
|------|------|------|
| Project 1 | âœ… å®Œæˆ | å†…å­˜é”®å€¼å­˜å‚¨ + CLI æ¡†æ¶ |
| Project 2 | âœ… å®Œæˆ | æ—¥å¿—ç»“æ„åŒ–æ–‡ä»¶ I/O + å‹ç¼© |
| Project 3 | âœ… å®Œæˆ | åŒæ­¥å®¢æˆ·ç«¯-æœåŠ¡ç«¯ç½‘ç»œ + å¯æ’æ‹”å¼•æ“ |
| Project 4 | ğŸ”² å¾…å¼€å§‹ | å¹¶å‘ä¸å¹¶è¡Œ |
| Project 5 | ğŸ”² å¾…å¼€å§‹ | å¼‚æ­¥ I/O |

## é¡¹ç›®ç»“æ„

```
project/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # åº“å…¥å£ï¼Œæ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ error.rs            # è‡ªå®šä¹‰é”™è¯¯ç±»å‹ (thiserror)
â”‚   â”œâ”€â”€ common.rs           # å®¢æˆ·ç«¯-æœåŠ¡ç«¯é€šä¿¡åè®® (Request/Response)
â”‚   â”œâ”€â”€ server.rs           # KvsServer â€” TCP æœåŠ¡ç«¯
â”‚   â”œâ”€â”€ client.rs           # KvsClient â€” TCP å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ engines/
â”‚   â”‚   â”œâ”€â”€ mod.rs          # KvsEngine trait å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ kvs.rs          # KvStore å®ç° (Bitcask æ¨¡å‹)
â”‚   â”‚   â””â”€â”€ sled_engine.rs  # SledKvsEngine é€‚é…å™¨
â”‚   â””â”€â”€ bin/
â”‚       â”œâ”€â”€ kvs-server.rs   # æœåŠ¡ç«¯ CLI
â”‚       â””â”€â”€ kvs-client.rs   # å®¢æˆ·ç«¯ CLI
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ kv_store.rs         # å­˜å‚¨å¼•æ“é›†æˆæµ‹è¯• (6 ä¸ª)
â”‚   â””â”€â”€ cli.rs              # å®¢æˆ·ç«¯-æœåŠ¡ç«¯ CLI æµ‹è¯• (11 ä¸ª)
â”œâ”€â”€ benches/
â”‚   â””â”€â”€ engine_bench.rs     # kvs vs sled æ€§èƒ½åŸºå‡†æµ‹è¯•
â””â”€â”€ examples/
    â”œâ”€â”€ tcp_json_client.rs  # TCP + JSON æµå¼åè®®ç¤ºä¾‹
    â””â”€â”€ tcp_json_server.rs
```

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         TCP/JSON          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KvsClient   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         KvsServer            â”‚
â”‚              â”‚   Request { Set/Get/Rm }  â”‚                              â”‚
â”‚  kvs-client  â”‚   Response { Ok/Err }    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚    KvsEngine trait      â”‚  â”‚
                                          â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                                          â”‚  â”‚ KvStore    â”‚ SledKvs   â”‚  â”‚
                                          â”‚  â”‚ (Bitcask)  â”‚ (sled)    â”‚  â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæœºåˆ¶ï¼š**
- **å¯æ’æ‹”å¼•æ“**ï¼š`KvsEngine` trait æŠ½è±¡ï¼Œæ”¯æŒ kvs (Bitcask) å’Œ sled ä¸¤ç§åç«¯
- **TCP ç½‘ç»œåè®®**ï¼šåŸºäº `serde_json` æµå¼åºåˆ—åŒ–çš„ Request/Response é€šä¿¡
- **å¼•æ“é”å®š**ï¼šé¦–æ¬¡å¯åŠ¨åå¼•æ“ç±»å‹å†™å…¥ç£ç›˜ï¼Œåç»­å¯åŠ¨è‡ªåŠ¨æ£€æµ‹å¹¶æ‹’ç»åˆ‡æ¢
- **æ—¥å¿—å‹ç¼©**ï¼šKvStore å¼•æ“åœ¨è¿‡æœŸæ•°æ®è¶…è¿‡ 1MB æ—¶è‡ªåŠ¨é‡å†™æœ‰æ•ˆæ¡ç›®
- **ç»“æ„åŒ–æ—¥å¿—**ï¼šä½¿ç”¨ `slog` è®°å½•æœåŠ¡ç«¯è¿è¡ŒçŠ¶æ€

## æŠ€æœ¯æ ˆ

| ä¾èµ– | ç”¨é€” |
|------|------|
| `clap v4.5` (derive) | CLI å‚æ•°è§£æ |
| `serde` + `serde_json` | å‘½ä»¤åºåˆ—åŒ–/ååºåˆ—åŒ– + TCP æµå¼åè®® |
| `thiserror v2.0` | å£°æ˜å¼é”™è¯¯ç±»å‹ |
| `slog` + `slog-term` + `slog-async` | ç»“æ„åŒ–æ—¥å¿— |
| `sled v0.34` | åµŒå…¥å¼æ•°æ®åº“å¼•æ“ |
| `criterion v0.5` | æ€§èƒ½åŸºå‡†æµ‹è¯• |

## ä½¿ç”¨æ–¹æ³•

```bash
# å¯åŠ¨æœåŠ¡ç«¯ (é»˜è®¤ kvs å¼•æ“ï¼Œç›‘å¬ 127.0.0.1:4000)
cargo run --bin kvs-server

# å¯åŠ¨æœåŠ¡ç«¯ (æŒ‡å®š sled å¼•æ“å’Œåœ°å€)
cargo run --bin kvs-server -- --engine sled --addr 127.0.0.1:5000

# å®¢æˆ·ç«¯æ“ä½œ
cargo run --bin kvs-client -- set mykey myvalue
cargo run --bin kvs-client -- get mykey
cargo run --bin kvs-client -- rm mykey

# æŒ‡å®šæœåŠ¡ç«¯åœ°å€
cargo run --bin kvs-client -- --addr 127.0.0.1:5000 get mykey
```

## æ„å»ºä¸æµ‹è¯•

```bash
cargo build                    # æ„å»º
cargo test                     # è¿è¡Œå…¨éƒ¨ 17 ä¸ªæµ‹è¯•
cargo bench                    # è¿è¡Œ kvs vs sled åŸºå‡†æµ‹è¯•
cargo clippy --all-targets     # lint æ£€æŸ¥
cargo fmt --check              # æ ¼å¼æ£€æŸ¥
```

## ä»£ç è´¨é‡

- `#![deny(missing_docs)]` å¼ºåˆ¶æ–‡æ¡£è¦†ç›–
- æ‰€æœ‰å…¬å…± API åŒ…å« `# Errors` æ–‡æ¡£æ®µ
- åº“ä»£ç æ—  `expect()` / `unwrap()` â€” å…¨éƒ¨ä½¿ç”¨ `?` é”™è¯¯ä¼ æ’­
- `thiserror` å£°æ˜å¼é”™è¯¯ç±»å‹ï¼Œè¦†ç›– I/Oã€åºåˆ—åŒ–ã€ç½‘ç»œã€å¼•æ“ç­‰åœºæ™¯

## è®¸å¯è¯

MIT OR Apache-2.0
